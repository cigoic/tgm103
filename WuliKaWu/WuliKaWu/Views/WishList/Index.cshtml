<div id="wishlistIndex">
    <div class="breadcrumb-area bg-gray-4 breadcrumb-padding-1">
        <div class="container">
            <div class="breadcrumb-content text-center">
                <h2>Wishlist</h2>
                <ul>
                    <li><a href="/wishlist/Index">Home</a></li>
                    <li><i class="ti-angle-right"></i></li>
                    <li>Wishlist</li>
                </ul>
            </div>
        </div>
        <div class="breadcrumb-img-1">
            <img src="/assets/images/banner/breadcrumb-1.png" alt="">
        </div>
        <div class="breadcrumb-img-2">
            <img src="/assets/images/banner/breadcrumb-2.png" alt="">
        </div>
    </div>
    <div class="wishlist-area pb-100 pt-100">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <form>
                        <div class="wishlist-table-content">
                            <div class="table-content table-responsive">
                                <table>
                                    <thead>
                                        <tr>
                                            <th class="width-remove"></th>
                                            <th class="width-thumbnail"></th>
                                            <th class="width-name">Product</th>
                                            <th class="width-price">Price</th>
                                            <th class="width-wishlist-cart"></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr v-for="product in productInThisWishList">
                                            <td class="pro-remove">
                                                <button type="button" v-on:click="RemoveToWishlist(product.wishlistId)"><i class=" ti-trash "></i></button>
                                            </td>
                                            <td class="product-thumbnail">
                                                <img class="width-thumbnail" style="width:120px" :src="product.picturePath[0]"></img>
                                            </td>
                                            <td class="product-name">
                                                <h5><a href="/Products/ProductDetails">{{product.productName}}</a></h5>
                                            </td>
                                            <td class="product-price">
                                                <span :class="{'old-price':product.discount}">${{product.price}}</span>
                                                <span class="new-price" v-if="product.discount">${{product.sellingPrice}}</span>
                                            </td>
                                            @*加入購物車Button 尚未完成*@
                                            <td class="wishlist-cart btn-hover">
                                                <button class="product-action-btn-2" type="button" title="Add To Cart" v-on:click="addToCart(product.productId)"><i class="pe-7s-cart"></i> Add to cart</button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts{

    <script>
        let app = new Vue({
            el: "#wishlistIndex",
            data: {
                productInThisWishList: {
                    wishlistId: [],
                    product: [],
                }
            },
            mounted: function () {
                var self = this;
                fetch('/api/wishlist/GetWishList/')
                    .then(function (response) { return response.json() })
                    .then(function (result) {
                        console.log(result);
                        self.productInThisWishList = result;
                    })
            },
            methods:
            {
                addToCart: function (productId) {
                    console.log("CPid:", productId)
                    this.queryCartBaseURL = '/api/cart/AddToCart/' + productId;
                    fetch(this.queryCartBaseURL, { method: "POST" })
                        .then(function (response) {
                            console.table(response)
                            let cartp = response
                            return response.json()
                        })
                        .then(function (result) {
                            var al = {
                                icon: 'sucess',
                                title: '成功',
                                text: result.message,
                                timer: 2000
                            };
                            if (!result.status) {
                                al.icon = "error";
                                al.title = "失敗";
                            }
                            Swal.fire(al)
                        })
                },
                RemoveToWishlist(id) {
                    console.log("RPid", id)
                    this.queryWishListBaseURL = '/api/wishlist/RemoveToWishlist/' + id;
                    fetch(this.queryWishListBaseURL, { method: "POST" })
                        .then(function (reponse) { return response.json() })
                        .then(function (result) {
                            alert(result);
                        })
                }

            }
        });

    </script>

}